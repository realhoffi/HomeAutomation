{"version":3,"sources":["webpack:///webpack/bootstrap ee37e04aebf6f84c828d","webpack:///./src/global/server.tsx","webpack:///external \"path\"","webpack:///external \"http\"","webpack:///external \"express\"","webpack:///external \"debug\"","webpack:///external \"url\"","webpack:///external \"serve-favicon\"","webpack:///./src/api/routes/routes.ts","webpack:///external \"body-parser\"","webpack:///external \"lumi-aqara\""],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AC7DA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,iBAAiB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,cAAc,UAAU,eAAe;AACvC;AACA,yDAAyD,kBAAkB;AAC3E;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,CAAC;AACD;AACA;AACA,+BAA+B,yCAAyC;AACxE;AACA,CAAC;AACD;AACA;AACA,yBAAyB,aAAa;AACtC,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,KAAK;AACL,CAAC;;;;;;;;;;;;ACtKD,iC;;;;;;;;;;;ACAA,iC;;;;;;;;;;;ACAA,oC;;;;;;;;;;;ACAA,kC;;;;;;;;;;;ACAA,gC;;;;;;;;;;;ACAA,0C;;;;;;;;;;;;ACAA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA,kBAAkB,UAAU;AAC5B,KAAK;AACL;AACA,kBAAkB,UAAU;AAC5B,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,kBAAkB,mBAAmB;AACrC,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,kBAAkB,gCAAgC;AAClD,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,kCAAkC,oEAAoE;AACtG;AACA,KAAK;AACL;AACA;;;;;;;;;;;;ACpEA,wC;;;;;;;;;;;ACAA,uC","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ee37e04aebf6f84c828d","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar path = require(\"path\");\r\nvar http = require(\"http\");\r\nvar express = require(\"express\");\r\nvar debug = require(\"debug\");\r\nvar url = require(\"url\");\r\nvar favicon = require(\"serve-favicon\");\r\nvar routes_1 = require(\"../api/routes/routes\");\r\nvar bodyParser = require(\"body-parser\");\r\nvar Aqara = require(\"lumi-aqara\");\r\nfunction normalizePort(val) {\r\n    var port = parseInt(val, 10);\r\n    if (isNaN(port)) {\r\n        return val;\r\n    }\r\n    if (port >= 0) {\r\n        return port;\r\n    }\r\n    return false;\r\n}\r\nfunction getUriFromRequest(request) {\r\n    return url.format({\r\n        protocol: request.protocol,\r\n        host: request.get(\"host\"),\r\n        pathname: request.originalUrl\r\n    });\r\n}\r\nvar app = express();\r\nvar log = debug(\"serverjs\");\r\nvar port = normalizePort(process.env.PORT || 8080);\r\nvar env = process.env.NODE_ENV || \"production\";\r\napp.set(\"port\", port);\r\napp.use(favicon(path.join(__dirname, \"icons\", \"favicon.ico\")));\r\napp.use(\"/css\", express.static(path.join(__dirname, \"css\")));\r\napp.use(\"/js\", express.static(path.join(__dirname, \"js\")));\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(bodyParser.json());\r\nvar router = express.Router();\r\nrouter.use(function (req, res, next) {\r\n    var uri = getUriFromRequest(req);\r\n    console.log(\"Request on URL: \" + uri);\r\n    next();\r\n});\r\nroutes_1.registerRoutes(router);\r\napp.use(\"/api\", router);\r\napp.locals = { xiaomi: { gateways: [] } };\r\napp.get(\"/\", function (request, response) {\r\n    response.sendFile(path.join(\"views\", \"index.html\"), { root: __dirname }, function (error) {\r\n        app.locals.test += 1;\r\n        if (error) {\r\n            console.log(\"ERROR SENDFILE!\" + JSON.stringify(error));\r\n        }\r\n        response.end();\r\n    });\r\n});\r\napp.get(\"*\", function (request, response) {\r\n    var uri = getUriFromRequest(request);\r\n    response.status(404).json({ \"error\": \"route \" + uri + \" not found\" });\r\n    console.log(\"catch wrong api request from URL: \" + uri);\r\n});\r\napp.use(function (err, req, res, next) {\r\n    res.status(500);\r\n    res.render(\"error\", { error: err });\r\n});\r\napp.listen(3000);\r\nvar server = http.createServer(app);\r\nserver.listen(port, function (err) {\r\n    if (err) {\r\n        return console.error(err);\r\n    }\r\n    console.info(\"Server running on http://localhost:\" + port + \" [\" + env + \"]\");\r\n});\r\nvar aqara = new Aqara();\r\naqara.on(\"gateway\", function (gateway) {\r\n    console.log(\"Gateway discovered\");\r\n    gateway.on(\"ready\", function () {\r\n        var exists = app.locals.xiaomi.gateways.filter(function (gw) {\r\n            return gateway.sid === gw;\r\n        });\r\n        if (!exists || exists.length === 0) {\r\n            console.log(\"Gateway existiert nicht\");\r\n            app.locals.xiaomi.gateways.push(gateway);\r\n        }\r\n        else {\r\n            console.log(\"Gateway existiert bereits\", gateway.sid);\r\n        }\r\n        console.log(\"Gateway is ready\");\r\n        console.log(\"IP:\", gateway.ip);\r\n        console.log(\"sid:\", gateway.sid);\r\n        gateway.setPassword(\"E2DFC915F00C49B4\");\r\n    });\r\n    gateway.on(\"offline\", function () {\r\n        gateway = null;\r\n        console.log(\"Gateway is offline\");\r\n    });\r\n    gateway.on(\"subdevice\", function (device) {\r\n        console.log(\"New device\");\r\n        console.log(\"  Battery: \" + device.getBatteryPercentage() + \"%\");\r\n        console.log(\"  Type: \" + device.getType());\r\n        console.log(\"  SID: \" + device.getSid());\r\n        switch (device.getType()) {\r\n            case \"magnet\":\r\n                console.log(\"  Magnet (\" + (device.isOpen() ? \"open\" : \"close\") + \")\");\r\n                device.on(\"open\", function () {\r\n                    console.log(device.getSid() + \" is now open\");\r\n                });\r\n                device.on(\"close\", function () {\r\n                    console.log(device.getSid() + \" is now close\");\r\n                });\r\n                break;\r\n            case \"switch\":\r\n                console.log(\"  Switch\");\r\n                device.on(\"click\", function () {\r\n                    console.log(device.getSid() + \" is clicked\");\r\n                });\r\n                device.on(\"doubleClick\", function () {\r\n                    console.log(device.getSid() + \" is double clicked\");\r\n                });\r\n                device.on(\"longClickPress\", function () {\r\n                    console.log(device.getSid() + \" is long pressed\");\r\n                });\r\n                device.on(\"longClickRelease\", function () {\r\n                    console.log(device.getSid() + \" is long released\");\r\n                });\r\n                break;\r\n            case \"motion\":\r\n                console.log(\"  Motion (\" + (device.hasMotion() ? \"motion\" : \"no motion\") + \")\");\r\n                device.on(\"motion\", function () {\r\n                    console.log(device.getSid() + \" has motion\" + (device.getLux() !== null ? \" (lux:\" + device.getLux() + \")\" : \"\"));\r\n                });\r\n                device.on(\"noMotion\", function () {\r\n                    console.log(device.getSid() + \" has no motion (inactive:\" + device.getSecondsSinceMotion() + (device.getLux() !== null ? \" lux:\" + device.getLux() : \"\") + \")\");\r\n                });\r\n                break;\r\n            case \"sensor\":\r\n                console.log(\"  Sensor (temperature:\" + device.getTemperature() + \"C rh:\" + device.getHumidity() + \"%\" + (device.getPressure() != null ? \" pressure:\" + device.getPressure() + \"kPa\" : \"\") + \")\");\r\n                device.on(\"update\", function () {\r\n                    console.log(device.getSid() + \" temperature: \" + device.getTemperature() + \"C rh:\" + device.getHumidity() + \"%\" + (device.getPressure() != null ? \" pressure:\" + device.getPressure() + \"kPa\" : \"\"));\r\n                });\r\n                break;\r\n            case \"leak\":\r\n                console.log(\"  Leak sensor\");\r\n                device.on(\"update\", function () {\r\n                    console.log(\"\" + device.getSid() + (device.isLeaking() ? \"\" : \" not\") + \" leaking\");\r\n                });\r\n                break;\r\n            case \"cube\":\r\n                console.log(\"  Cube\");\r\n                device.on(\"update\", function () {\r\n                    console.log(device.getSid() + \" \" + device.getStatus() + (device.getRotateDegrees() !== null ? \" \" + device.getRotateDegrees() : \"\"));\r\n                });\r\n                break;\r\n        }\r\n    });\r\n    gateway.on(\"lightState\", function (state) {\r\n        var b = -1;\r\n        console.log(\"Light updated: \" + JSON.stringify(state));\r\n        var exists = app.locals.xiaomi.gateways.find(function (gw, index) {\r\n            b = index;\r\n            return gateway.sid === gw;\r\n        });\r\n        if (b > -1) {\r\n            app.locals.xiaomi.gateways[b] = gateway;\r\n        }\r\n    });\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/global/server.tsx\n// module id = 1\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"debug\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"url\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"url\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"serve-favicon\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"serve-favicon\"\n// module id = 7\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction registerRoutes(router) {\r\n    router.route(\"/bears\").get(function (req, res) {\r\n        res.json({ \"ID\": 1 });\r\n    });\r\n    router.route(\"/tears\").get(function (req, res) {\r\n        res.json({ \"ID\": 2 });\r\n    });\r\n    router.route(\"/gateways\").get(function (req, res) {\r\n        var result = [];\r\n        var gateways = req.app.locals.xiaomi.gateways;\r\n        if (gateways && gateways.length > 0) {\r\n            result = gateways.map(function (gw) {\r\n                return {\r\n                    intensity: gw.intensity,\r\n                    sid: gw.sid,\r\n                    ip: gw.ip,\r\n                    on: gw.intensity > 0,\r\n                    rgb: gw.color\r\n                };\r\n            });\r\n        }\r\n        res.json({ gateways: result });\r\n    });\r\n    router.route(\"/gateways/:sid/intensity/:value\").post(function (req, res) {\r\n        var gateways = req.app.locals.xiaomi.gateways;\r\n        var gateway = gateways.find(function (gw) {\r\n            return gw.sid === req.params[\"sid\"];\r\n        });\r\n        if (gateway) {\r\n            console.log(\"found gw: \" + req.params.sid);\r\n            gateway.setIntensity(req.params.value);\r\n        }\r\n        res.json({ \"intensity\": req.params.value });\r\n    });\r\n    router.route(\"/gateways/:sid/color\").post(function (req, res) {\r\n        var gateways = req.app.locals.xiaomi.gateways;\r\n        var gateway = gateways.find(function (gw) {\r\n            return gw.sid === req.params[\"sid\"];\r\n        });\r\n        var color = req.body || undefined;\r\n        console.log(color);\r\n        if (gateway && color) {\r\n            console.log(\"found gw: \" + req.params.sid);\r\n            gateway.setColor(color);\r\n        }\r\n        res.json(color);\r\n    });\r\n    router.route(\"/gateways/:sid/\").get(function (req, res) {\r\n        var gateways = req.app.locals.xiaomi.gateways;\r\n        var gateway = gateways.find(function (gw) {\r\n            return gw.sid === req.params[\"sid\"];\r\n        });\r\n        if (gateway) {\r\n            res.status(200).json({\r\n                intensity: gateway.intensity,\r\n                sid: gateway.sid,\r\n                ip: gateway.ip,\r\n                on: gateway.intensity > 0,\r\n                rgb: gateway.color\r\n            });\r\n        }\r\n        else {\r\n            res.status(500).json({ error: \"Gateway mit sid \" + req.params[\"sid\"] + \" nicht gefunden\" });\r\n        }\r\n    });\r\n}\r\nexports.registerRoutes = registerRoutes;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/api/routes/routes.ts\n// module id = 8\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"lumi-aqara\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lumi-aqara\"\n// module id = 10\n// module chunks = 0"],"sourceRoot":""}